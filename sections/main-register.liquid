{{ 'customer.css' | asset_url | stylesheet_tag }}

{%- style -%}
.section-{{ section.id }}-padding {
  padding: 50px 20px 70px 20px; /* top | right | bottom | left */
  max-width: 800px;
  margin: 0 auto;
}
  
  .notice-box {
    background: #fff8dc;
    padding: 15px 20px;
    border-left: 4px solid #ffa726;
    font-size: 14px;
    border-radius: 6px;
    margin-bottom: 24px;
  }

  .form-title {
    font-size: 28px;
    font-weight: 600;
    margin-bottom: 24px;
    text-align: center;
  }

  .required-notice {
    font-size: 14px;
    margin-bottom: 20px;
    color: #666;
    text-align: center;
  }

  .form-section {
    background: #ffffff;
    padding: 40px;
    margin-bottom: 40px;
    border-radius: 16px;
    box-shadow: 0 0 24px rgba(0, 0, 0, 0.04);
    border: 1px solid #e5e7eb;
    transition: box-shadow 0.3s ease;
  }
  @media screen and (max-width: 768px) {
  .form-section {
    padding: 24px;
    margin-left: -10px;
    margin-right: -10px;
    border-radius: 12px;
  }
}

  .section-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 16px;
    padding-bottom: 10px;
    border-bottom: 2px solid #eeeeee;
    color: #333;
  }

  .field {
    margin-bottom: 20px;
  }

  .field-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }

  .field-group.street {
    grid-template-columns: 3fr 1fr;
  }

  .field-group-3 {
    display: grid;
    grid-template-columns: 80px 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }

  input[type="text"],
  input[type="email"],
  input[type="tel"],
  input[type="url"],
  input[type="password"],
  select {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 15px;
    background-color: #f9fafb;
    transition: all 0.2s ease;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.03);
  }

  input:focus,
  select:focus {
    border-color: #7c4d9a;
    background-color: #ffffff;
    outline: none;
    box-shadow: 0 0 0 3px rgba(124, 77, 154, 0.2);
  }

  input::placeholder {
    color: #666666;
    opacity: 1 !important;
  }

  select {
    appearance: none;
    background-image: url('data:image/svg+xml;utf8,<svg fill="none" stroke="%23666" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 9l-7 7-7-7"></path></svg>');
    background-repeat: no-repeat;
    background-position: right 16px center;
    background-size: 18px 18px;
    padding-right: 40px;
  }

  select:required:invalid {
    color: #666666;
  }

  select option[value=""] {
    color: #666666;
  }

  select option {
    color: black;
  }

  .radio-group {
    margin: 15px 0;
  }

  .radio-option {
    margin-bottom: 8px;
  }

  .radio-option input[type="radio"] {
    margin-right: 8px;
  }

  .file-upload {
    margin: 15px 0;
  }

  .file-upload-button {
    display: inline-block;
    padding: 10px 18px;
    background: #f0f0f0;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
  }
  .file-upload-button:hover {
  background: #e4e4e4; /* etwas dunkleres Grau */
  border-color: #c7c7c7;
}

  .file-info {
    font-size: 12px;
    color: #666;
    margin-top: 5px;
  }

.checkbox-group {
  margin: 20px 0;
  margin-bottom: 0;
}

.checkbox-group p {
  text-align: center;
  margin-top: -10px; /* üëà HIER! Abstand nach oben */
  margin-bottom: 24px;
  font-size: 14px;
  color: #666;
}

.checkbox-field {
  margin-bottom: 16px;
  display: flex;
  align-items: flex-start;
  gap: 10px;
  text-align: left;
}

.checkbox-field input[type="checkbox"] {
  margin-top: 5px;
  flex-shrink: 0;
}

.checkbox-field label {
  font-size: 14px;
  color: #333;
  line-height: 1.5;
}

.submit-button {
  background: #7c4d9a;
  color: white;
  padding: 14px 32px;
  font-size: 16px;
  font-weight: 500;
  border: none;
  border-radius: 30px;
  cursor: pointer;
  display: block;
  margin: 8px auto 96px auto; /* üîÅ Oberer Abstand reduziert, unterer erh√∂ht */
  transition: background 0.3s ease;
}

.submit-button:hover {
  background: #333333;
}

.checkbox-group .checkbox-field:last-of-type {
  margin-bottom: 8px;
}

@media screen and (max-width: 768px) {
  .field-group,
  .field-group-3 {
    grid-template-columns: 1fr;
  }

  .submit-button {
    width: 100%;
    float: none;
    display: block;
    margin: 8px auto 64px auto; /* Gleicher Abstand wie im Desktop-Bereich */
  }
}

  .success-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 9999;
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background: white;
    padding: 30px;
    border-radius: 12px;
    text-align: center;
    max-width: 400px;
    width: 90%;
  }

  .modal-content h2 {
    color: #8cc63f;
    margin-bottom: 15px;
  }

  .modal-content p {
    color: #666;
    margin-bottom: 20px;
  }

  .loading-spinner {
    border: 3px solid #f3f3f3;
    border-top: 3px solid #8cc63f;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Platzhalter nach oben verschieben bei Fokus */
input::placeholder,
select::placeholder {
  transform: translateY(0px);
  line-height: 1.2;
}

input:focus::placeholder,
select:focus::placeholder {
  transform: translateY(-4px);
  opacity: 0.9;
}
  
{%- endstyle -%}


<div class="customer register section-{{ section.id }}-padding">
  <h1 class="form-title">Registrierung</h1>
  
  <div class="notice-box">
    Bitte beachten Sie:<br>
    Mit * markierte Felder sind Pflichtfelder
  </div>


  {%- form 'create_customer', id: 'RegisterForm', novalidate: 'novalidate' -%}
    <input type="hidden" name="_replyto" value="shop@bab-distribution.de">
    <input type="hidden" name="_next" value="{{ shop.url }}/account/register">

    <div class="form-section">
      <div class="section-title">Pers√∂nliche Daten</div>
      
      <div class="field-group">
        <div class="field">
          <select name="customer[note][salutation]" id="RegisterForm-Salutation" required>
            <option value="" disabled selected hidden>Anrede*</option>
            <option value="Herr">Herr</option>
            <option value="Frau">Frau</option>
            <option value="Divers">Divers</option>
          </select>
        </div>
        <div class="field">
          <select name="customer[note][title]" id="RegisterForm-Title">
            <option value="" disabled selected hidden>Kein Titel</option>
            <option value="Dr.">Dr.</option>
            <option value="Prof.">Prof.</option>
            <option value="Prof. Dr.">Prof. Dr.</option>
          </select>
        </div>
      </div>

      <div class="field-group">
        <div class="field">
          <input type="text" 
                 id="RegisterForm-FirstName" 
                 name="customer[first_name]" 
                 placeholder="Vorname*"
                 required>
        </div>
        <div class="field">
          <input type="text" 
                 id="RegisterForm-LastName" 
                 name="customer[last_name]" 
                 placeholder="Nachname*"
                 required>
        </div>
      </div>

      <div class="field">
        <input type="email" 
               id="RegisterForm-email" 
               name="customer[email]" 
               placeholder="E-Mail-Adresse*"
               required>
      </div>

      <div class="field">
        <input type="password" 
               id="RegisterForm-password" 
               name="customer[password]" 
               placeholder="Passwort*"
               required
               minlength="5">
        <div style="font-size: 12px; color: #666; margin-top: 5px;">
          Mindestens 5 Zeichen
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="section-title">Kontoinformationen</div>
      
      <div class="field">
        <input type="text" 
               id="RegisterForm-Company" 
               name="customer[note][company]" 
               placeholder="Firmenname (inkl. Rechtsform)*"
               required>
      </div>

      <div class="field-group street">
        <div class="field">
          <input type="text" 
                 id="RegisterForm-Street" 
                 name="customer[note][street]" 
                 placeholder="Stra√üe*"
                 required>
        </div>
        <div class="field">
          <input type="text" 
                 id="RegisterForm-Number" 
                 name="customer[note][street_number]" 
                 placeholder="Nr.*"
                 required>
        </div>
      </div>

      <div class="field">
        <input type="text" 
               id="RegisterForm-AddressInfo" 
               name="customer[note][address_info]" 
               placeholder="Adresszusatz / Ansprechpartner">
      </div>

      <div class="field-group-3">
        <div class="field">
          <input type="text" 
                 id="RegisterForm-Zip" 
                 name="customer[note][zip]" 
                 placeholder="PLZ*"
                 required>
        </div>
        <div class="field">
          <input type="text" 
                 id="RegisterForm-City" 
                 name="customer[note][city]" 
                 placeholder="Ort*"
                 required>
        </div>
        <div class="field">
          <select id="RegisterForm-Country" name="customer[note][country]" required>
            <option value="">Land*</option>
            <option value="DE">Deutschland</option>
            <option value="AT">√ñsterreich</option>
            <option value="CH">Schweiz</option>
          </select>
        </div>
      </div>

      <div class="field">
        <input type="tel" 
               id="RegisterForm-Phone" 
               name="customer[note][phone]" 
               placeholder="Telefonnummer*"
               required>
      </div>

      <div class="field">
        <input type="text" 
               id="RegisterForm-VAT" 
               name="customer[note][vat_id]" 
               placeholder="USt-ID">
      </div>

      <div class="field">
        <input type="url" 
               id="RegisterForm-Website" 
               name="customer[note][website]" 
               placeholder="Website">
      </div>

      <div class="field">
        <input type="text" 
               id="RegisterForm-Commercial" 
               name="customer[note][commercial_register]" 
               placeholder="Handelsregisternr.">
      </div>

      <div class="file-upload">
        <label class="file-upload-button" for="RegisterForm-Document">
          Hier Gewerbeanmeldung/HRA hochladen
        </label>
        <input type="file" 
               id="RegisterForm-Document" 
               name="attachment" 
               accept=".pdf,.jpg,.jpeg,.png"
               style="display: none;">
        <div class="file-info">Maximale Dateigr√∂√üe: 5 MB</div>
        <div id="file-upload-status" style="margin-top: 5px; color: #666;"></div>
      </div>
    </div>

    <div class="checkbox-group">
      <p style="margin-bottom: 20px; color: #666;">Die Rechnungen erhalten Sie per Mail.</p>

      <div class="checkbox-field">
    <input type="checkbox" id="RegisterForm-Agb" name="customer[note][privacy]" required>
    <label for="RegisterForm-Agb">
        Ich best√§tige, dass ich die 
        <a href="https://terra-robotics.de/pages/agb" target="_blank" rel="noopener noreferrer">
            Allgemeinen Gesch√§ftsbedingungen
        </a> gelesen habe und ihnen zustimme.*
    </label>
</div>


      <div class="checkbox-field">
        <input type="checkbox" id="RegisterForm-Privacy" name="customer[note][privacy]" required>
        <label for="RegisterForm-Privacy">Ich habe die Hinweise zum Datenschutz gelesen und bin mit der Speicherung meiner Daten einverstanden.*</label>
      </div>

      <div class="checkbox-field">
        <input type="checkbox" id="RegisterForm-Newsletter" name="customer[accepts_marketing]">
        <label for="RegisterForm-Newsletter">Newsletter abonnieren (Erhalte immer aktuelle Angebote)</label>
      </div>
    </div>

    <button type="submit" class="submit-button" disabled>Anfrage absenden</button>
  {%- endform -%}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('RegisterForm');
    const submitButton = form.querySelector('button[type="submit"]');
    const fileInput = document.getElementById('RegisterForm-Document');
    const fileStatus = document.getElementById('file-upload-status');
    const privacyCheckbox = document.getElementById('RegisterForm-Privacy');
    const agb = document.getElementById('RegisterForm-Agb');

    const requiredFields = [
      'RegisterForm-Salutation',
      'RegisterForm-FirstName',
      'RegisterForm-LastName',
      'RegisterForm-email',
      'RegisterForm-password',
      'RegisterForm-Company',
      'RegisterForm-Street',
      'RegisterForm-Number',
      'RegisterForm-Zip',
      'RegisterForm-City',
      'RegisterForm-Country',
      'RegisterForm-Phone'
    ];

    function validateForm() {
      let isValid = true;

      // Pr√ºfe alle Pflichtfelder
      requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!field.value || (field.tagName === 'SELECT' && field.value === "")) {
          isValid = false;
        }
      });

      // Pr√ºfe Datenschutz-Checkbox
      if (!privacyCheckbox.checked) {
        isValid = false;
      }

      // Email-Validierung
      const emailField = document.getElementById('RegisterForm-email');
      if (!emailField.value || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailField.value.trim())) {
        isValid = false;
      }

      // Telefonnummer-Validierung
      const phoneField = document.getElementById('RegisterForm-Phone');
      if (!phoneField.value || !/^[0-9\s+-]{6,}$/.test(phoneField.value.trim())) {
        isValid = false;
      }

      // Button-Status aktualisieren
      submitButton.disabled = !isValid;
      submitButton.style.opacity = isValid ? '1' : '0.5';
      submitButton.style.cursor = isValid ? 'pointer' : 'not-allowed';

      return isValid;
    }

    // Event-Listener f√ºr alle Pflichtfelder
    requiredFields.forEach(fieldId => {
      const field = document.getElementById(fieldId);
      ['input', 'change', 'blur'].forEach(eventType => {
        field.addEventListener(eventType, validateForm);
      });
    });

    // Event-Listener f√ºr Datenschutz-Checkbox
    privacyCheckbox.addEventListener('change', validateForm);

    // Initiale Validierung
    validateForm();

    // Zeige ausgew√§hlte Datei an
    fileInput.addEventListener('change', function(e) {
      if (this.files && this.files.length > 0) {
        const file = this.files[0];
        if (file.size > 5 * 1024 * 1024) {
          fileStatus.textContent = 'Fehler: Datei ist gr√∂√üer als 5MB';
          fileStatus.style.color = 'red';
          this.value = '';
        } else {
          fileStatus.textContent = 'Ausgew√§hlte Datei: ' + file.name;
          fileStatus.style.color = '#666';
        }
      } else {
        fileStatus.textContent = '';
      }
      validateForm();
    });

    form.addEventListener('submit', async function(event) {
      if (!validateForm()) {
        return;
      }

      // Verhindere zun√§chst das Absenden
      event.preventDefault();

      // Speichere die Formspree-Daten im localStorage
      const formspreeData = {
        email: document.getElementById('RegisterForm-email').value,
        company: document.getElementById('RegisterForm-Company').value,
        salutation: document.getElementById('RegisterForm-Salutation').value,
        title: document.getElementById('RegisterForm-Title').value,
        firstName: document.getElementById('RegisterForm-FirstName').value,
        lastName: document.getElementById('RegisterForm-LastName').value,
        street: document.getElementById('RegisterForm-Street').value,
        number: document.getElementById('RegisterForm-Number').value,
        addressInfo: document.getElementById('RegisterForm-AddressInfo').value,
        zip: document.getElementById('RegisterForm-Zip').value,
        city: document.getElementById('RegisterForm-City').value,
        country: document.getElementById('RegisterForm-Country').value,
        phone: document.getElementById('RegisterForm-Phone').value,
        vat: document.getElementById('RegisterForm-VAT').value,
        website: document.getElementById('RegisterForm-Website').value,
        commercial: document.getElementById('RegisterForm-Commercial').value,
        hasFile: fileInput.files.length > 0
      };
      
      localStorage.setItem('formspreeData', JSON.stringify(formspreeData));

      // Speichere die Datei im localStorage und warte darauf
      if (fileInput.files.length > 0) {
        const file = fileInput.files[0];
        await new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = function(e) {
            const arrayBuffer = e.target.result;
            const array = new Uint8Array(arrayBuffer);
            const fileData = {
              name: file.name,
              type: file.type,
              data: Array.from(array)
            };
            localStorage.setItem('formspreeFile', JSON.stringify(fileData));
            resolve();
          };
          reader.readAsArrayBuffer(file);
        });
      }
      
      // Jetzt k√∂nnen wir das Formular absenden
      form.submit();
    });
  });
</script>

{% schema %}
{
  "name": "t:sections.main-register.name",
  "settings": [
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ]
}
{% endschema %}
